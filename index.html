<!DOCTYPE html>
<html>
<head>
  <title>Drug Half-Life Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .dose-input { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
    #chart { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="dose-input">
    <input type="text" id="drug" placeholder="Drug (e.g., Abilify)">
    <input type="number" id="dose" placeholder="Dose (mg)" step="0.1">
    <input type="number" id="halfLife" placeholder="Half-life (hours)">
    <input type="number" id="timeSinceDose" placeholder="Time since dose (hours)">
    <button onclick="addDose()">Add Dose</button>
  </div>

  <div id="doseList"></div>
  <button onclick="calculate()">Calculate</button>
  <canvas id="chart"></canvas>

  <script>
    let doses = [];
    let chart = null;

    function addDose() {
      const drug = document.getElementById('drug').value;
      const dose = parseFloat(document.getElementById('dose').value);
      const halfLife = parseFloat(document.getElementById('halfLife').value);
      const timeSinceDose = parseFloat(document.getElementById('timeSinceDose').value);

      doses.push({ drug, dose, halfLife, timeSinceDose });
      updateDoseList();
    }

    function calculate() {
      const timePoints = Array.from({ length: 168 }, (_, i) => i); // 7 days
      const concentrations = timePoints.map(t => 
        doses.reduce((sum, dose) => {
          const totalTime = dose.timeSinceDose + t;
          return totalTime >= 0 ? 
            sum + dose.dose * Math.pow(0.5, totalTime / dose.halfLife) : 
            sum;
        }, 0)
      );

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('chart'), {
        type: 'line',
        data: {
          labels: timePoints.map(t => `${Math.floor(t/24)}d ${t%24}h`),
          datasets: [{
            label: 'Total Drug Concentration (mg)',
            data: concentrations,
            borderColor: 'rgb(75, 192, 192)'
          }]
        }
      });
    }

    function updateDoseList() {
      document.getElementById('doseList').innerHTML = doses
        .map((dose, i) => `
          <div>Dose ${i+1}: 
            ${dose.drug} ${dose.dose}mg, 
            tÂ½=${dose.halfLife}h, 
            taken ${dose.timeSinceDose}h ago
          </div>
        `).join('');
    }
  </script>
</body>
</html>